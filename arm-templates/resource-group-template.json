{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "IotHubs_YOUR_IOT_HUB_NAME_connectionString": {
      "type": "SecureString"
    },
    "IotHubs_YOUR_IOT_HUB_NAME_containerName": {
      "type": "SecureString"
    },
    "IotHubs_YOUR_IOT_HUB_NAME_name": {
      "defaultValue": "YOUR_IOT_HUB_NAME",
      "type": "String"
    },
    "IotHubs_YOUR_IOT_HUB_NAME_s1_connectionString": {
      "type": "SecureString"
    },
    "IotHubs_YOUR_IOT_HUB_NAME_s1_containerName": {
      "type": "SecureString"
    },
    "IotHubs_YOUR_IOT_HUB_NAME_s1_name": {
      "defaultValue": "YOUR_IOT_HUB_NAME",
      "type": "String"
    },
    "accounts_speech_name": {
      "defaultValue": "YOUR_SPEECH_SERVICE",
      "type": "String"
    },
    "accounts_speech_service_name": {
      "defaultValue": "YOUR_SPEECH_SERVICE",
      "type": "String"
    },
    "actionGroups_Application_Insights_Smart_Detection_name": {
      "defaultValue": "Application Insights Smart Detection",
      "type": "String"
    },
    "components_conversation_logger_name": {
      "defaultValue": "YOUR_CONVERSATION_LOGGER",
      "type": "String"
    },
    "components_conversation_logger_py_name": {
      "defaultValue": "YOUR_CONVERSATION_LOGGER",
      "type": "String"
    },
    "components_memory_generator_name": {
      "defaultValue": "YOUR_MEMORY_GENERATOR",
      "type": "String"
    },
    "databaseAccounts_cosmos_name": {
      "defaultValue": "YOUR_COSMOS_DB",
      "type": "String"
    },
    "registries_YOUR_ACR_NAME_name": {
      "defaultValue": "YOUR_ACR_NAME",
      "type": "String"
    },
    "serverfarms_JapanEastLinuxDynamicPlan_name": {
      "defaultValue": "JapanEastLinuxDynamicPlan",
      "type": "String"
    },
    "sites_conversation_logger_py_name": {
      "defaultValue": "YOUR_CONVERSATION_LOGGER",
      "type": "String"
    },
    "sites_memory_generator_name": {
      "defaultValue": "YOUR_MEMORY_GENERATOR",
      "type": "String"
    },
    "smartdetectoralertrules_failure_anomalies_conversation_logger_name": {
      "defaultValue": "failure anomalies - YOUR_CONVERSATION_LOGGER",
      "type": "String"
    },
    "smartdetectoralertrules_failure_anomalies_conversation_logger_py_name": {
      "defaultValue": "failure anomalies - YOUR_CONVERSATION_LOGGER",
      "type": "String"
    },
    "smartdetectoralertrules_failure_anomalies_memory_generator_name": {
      "defaultValue": "failure anomalies - YOUR_MEMORY_GENERATOR",
      "type": "String"
    },
    "storageAccounts_storage_name": {
      "defaultValue": "YOUR_STORAGE_ACCOUNT",
      "type": "String"
    },
    "vaults_YOUR_KEY_VAULT_name": {
      "defaultValue": "YOUR_KEY_VAULT",
      "type": "String"
    },
    "workspaces_default_workspace_externalid": {
      "defaultValue": "/subscriptions/YOUR_SUBSCRIPTION_ID/resourceGroups/YOUR_RESOURCE_GROUP/providers/Microsoft.OperationalInsights/workspaces/YOUR_WORKSPACE_NAME",
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2025-06-01",
      "kind": "SpeechServices",
      "location": "japaneast",
      "name": "[parameters('accounts_speech_name')]",
      "properties": {
        "allowProjectManagement": false,
        "publicNetworkAccess": "Enabled"
      },
      "sku": {
        "name": "F0"
      },
      "type": "Microsoft.CognitiveServices/accounts"
    },
    {
      "apiVersion": "2025-06-01",
      "kind": "SpeechServices",
      "location": "japaneast",
      "name": "[parameters('accounts_speech_service_name')]",
      "properties": {
        "allowProjectManagement": false,
        "publicNetworkAccess": "Enabled"
      },
      "sku": {
        "name": "S0"
      },
      "type": "Microsoft.CognitiveServices/accounts"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "location": "japaneast",
      "name": "[parameters('registries_YOUR_ACR_NAME_name')]",
      "properties": {
        "adminUserEnabled": true,
        "anonymousPullEnabled": false,
        "autoGeneratedDomainNameLabelScope": "Unsecure",
        "dataEndpointEnabled": false,
        "encryption": {
          "status": "disabled"
        },
        "metadataSearch": "Disabled",
        "networkRuleBypassAllowedForTasks": false,
        "networkRuleBypassOptions": "AzureServices",
        "policies": {
          "azureADAuthenticationAsArmPolicy": {
            "status": "enabled"
          },
          "exportPolicy": {
            "status": "enabled"
          },
          "quarantinePolicy": {
            "status": "disabled"
          },
          "retentionPolicy": {
            "days": 7,
            "status": "disabled"
          },
          "softDeletePolicy": {
            "retentionDays": 7,
            "status": "disabled"
          },
          "trustPolicy": {
            "status": "disabled",
            "type": "Notary"
          }
        },
        "publicNetworkAccess": "Enabled",
        "roleAssignmentMode": "LegacyRegistryPermissions",
        "zoneRedundancy": "Disabled"
      },
      "sku": {
        "name": "Basic",
        "tier": "Basic"
      },
      "type": "Microsoft.ContainerRegistry/registries"
    },
    {
      "apiVersion": "2023-06-30",
      "identity": {
        "type": "None"
      },
      "location": "japaneast",
      "name": "[parameters('IotHubs_YOUR_IOT_HUB_NAME_name')]",
      "properties": {
        "allowedFqdnList": [],
        "cloudToDevice": {
          "defaultTtlAsIso8601": "PT1H",
          "feedback": {
            "lockDurationAsIso8601": "PT1M",
            "maxDeliveryCount": 10,
            "ttlAsIso8601": "PT1H"
          },
          "maxDeliveryCount": 10
        },
        "disableLocalAuth": false,
        "enableDataResidency": false,
        "enableFileUploadNotifications": false,
        "eventHubEndpoints": {
          "events": {
            "partitionCount": 2,
            "retentionTimeInDays": 1
          }
        },
        "features": "RootCertificateV2",
        "ipFilterRules": [],
        "messagingEndpoints": {
          "fileNotifications": {
            "lockDurationAsIso8601": "PT1M",
            "maxDeliveryCount": 10,
            "ttlAsIso8601": "PT1H"
          }
        },
        "routing": {
          "endpoints": {
            "cosmosDBSqlContainers": [],
            "eventHubs": [],
            "serviceBusQueues": [],
            "serviceBusTopics": [],
            "storageContainers": []
          },
          "fallbackRoute": {
            "condition": "true",
            "endpointNames": [
              "events"
            ],
            "isEnabled": true,
            "name": "$fallback",
            "source": "DeviceMessages"
          },
          "routes": [
            {
              "condition": "true",
              "endpointNames": [
                "events"
              ],
              "isEnabled": true,
              "name": "twin-change-route",
              "source": "TwinChangeEvents"
            }
          ]
        },
        "storageEndpoints": {
          "$default": {
            "connectionString": "[parameters('IotHubs_YOUR_IOT_HUB_NAME_connectionString')]",
            "containerName": "[parameters('IotHubs_YOUR_IOT_HUB_NAME_containerName')]",
            "sasTtlAsIso8601": "PT1H"
          }
        }
      },
      "sku": {
        "capacity": 1,
        "name": "F1",
        "tier": "Free"
      },
      "type": "Microsoft.Devices/IotHubs"
    },
    {
      "apiVersion": "2023-06-30",
      "identity": {
        "type": "None"
      },
      "location": "japaneast",
      "name": "[parameters('IotHubs_YOUR_IOT_HUB_NAME_s1_name')]",
      "properties": {
        "allowedFqdnList": [],
        "cloudToDevice": {
          "defaultTtlAsIso8601": "PT1H",
          "feedback": {
            "lockDurationAsIso8601": "PT1M",
            "maxDeliveryCount": 10,
            "ttlAsIso8601": "PT1H"
          },
          "maxDeliveryCount": 10
        },
        "disableLocalAuth": false,
        "enableDataResidency": false,
        "enableFileUploadNotifications": false,
        "eventHubEndpoints": {
          "events": {
            "partitionCount": 4,
            "retentionTimeInDays": 1
          }
        },
        "features": "RootCertificateV2",
        "ipFilterRules": [],
        "messagingEndpoints": {
          "fileNotifications": {
            "lockDurationAsIso8601": "PT1M",
            "maxDeliveryCount": 10,
            "ttlAsIso8601": "PT1H"
          }
        },
        "routing": {
          "endpoints": {
            "cosmosDBSqlContainers": [],
            "eventHubs": [],
            "serviceBusQueues": [],
            "serviceBusTopics": [],
            "storageContainers": []
          },
          "fallbackRoute": {
            "condition": "true",
            "endpointNames": [
              "events"
            ],
            "isEnabled": true,
            "name": "$fallback",
            "source": "DeviceMessages"
          },
          "routes": [
            {
              "condition": "true",
              "endpointNames": [
                "events"
              ],
              "isEnabled": true,
              "name": "twin-change-route",
              "source": "TwinChangeEvents"
            }
          ]
        },
        "storageEndpoints": {
          "$default": {
            "connectionString": "[parameters('IotHubs_YOUR_IOT_HUB_NAME_s1_connectionString')]",
            "containerName": "[parameters('IotHubs_YOUR_IOT_HUB_NAME_s1_containerName')]",
            "sasTtlAsIso8601": "PT1H"
          }
        }
      },
      "sku": {
        "capacity": 1,
        "name": "S1",
        "tier": "Standard"
      },
      "type": "Microsoft.Devices/IotHubs"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "identity": {
        "type": "None"
      },
      "kind": "GlobalDocumentDB",
      "location": "Japan East",
      "name": "[parameters('databaseAccounts_cosmos_name')]",
      "properties": {
        "analyticalStorageConfiguration": {
          "schemaType": "WellDefined"
        },
        "backupPolicy": {
          "periodicModeProperties": {
            "backupIntervalInMinutes": 240,
            "backupRetentionIntervalInHours": 8,
            "backupStorageRedundancy": "Geo"
          },
          "type": "Periodic"
        },
        "capabilities": [],
        "capacityMode": "Serverless",
        "consistencyPolicy": {
          "defaultConsistencyLevel": "Session",
          "maxIntervalInSeconds": 5,
          "maxStalenessPrefix": 100
        },
        "cors": [],
        "databaseAccountOfferType": "Standard",
        "defaultIdentity": "FirstPartyIdentity",
        "defaultPriorityLevel": "High",
        "diagnosticLogSettings": {
          "enableFullTextQuery": "None"
        },
        "disableKeyBasedMetadataWriteAccess": false,
        "disableLocalAuth": false,
        "enableAnalyticalStorage": false,
        "enableAutomaticFailover": true,
        "enableBurstCapacity": false,
        "enableFreeTier": false,
        "enableMaterializedViews": false,
        "enableMultipleWriteLocations": false,
        "enablePartitionMerge": false,
        "enablePerRegionPerPartitionAutoscale": false,
        "enablePriorityBasedExecution": false,
        "ipRules": [],
        "isVirtualNetworkFilterEnabled": false,
        "locations": [
          {
            "failoverPriority": 0,
            "isZoneRedundant": false,
            "locationName": "Japan East"
          }
        ],
        "minimalTlsVersion": "Tls12",
        "networkAclBypass": "None",
        "networkAclBypassResourceIds": [],
        "publicNetworkAccess": "Enabled",
        "virtualNetworkRules": []
      },
      "type": "Microsoft.DocumentDB/databaseAccounts"
    },
    {
      "apiVersion": "2024-10-01-preview",
      "location": "Global",
      "name": "[parameters('actionGroups_Application_Insights_Smart_Detection_name')]",
      "properties": {
        "armRoleReceivers": [
          {
            "name": "Monitoring Contributor",
            "roleId": "749f88d5-cbae-40b8-bcfc-e573ddc772fa",
            "useCommonAlertSchema": true
          },
          {
            "name": "Monitoring Reader",
            "roleId": "43d0d8ad-25c7-4714-9337-8ba259a9fe05",
            "useCommonAlertSchema": true
          }
        ],
        "automationRunbookReceivers": [],
        "azureAppPushReceivers": [],
        "azureFunctionReceivers": [],
        "emailReceivers": [],
        "enabled": true,
        "eventHubReceivers": [],
        "groupShortName": "SmartDetect",
        "itsmReceivers": [],
        "logicAppReceivers": [],
        "smsReceivers": [],
        "voiceReceivers": [],
        "webhookReceivers": []
      },
      "type": "microsoft.insights/actionGroups"
    },
    {
      "apiVersion": "2020-02-02",
      "kind": "web",
      "location": "japaneast",
      "name": "[parameters('components_conversation_logger_name')]",
      "properties": {
        "Application_Type": "web",
        "IngestionMode": "LogAnalytics",
        "RetentionInDays": 90,
        "WorkspaceResourceId": "[parameters('workspaces_default_workspace_externalid')]",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled"
      },
      "type": "microsoft.insights/components"
    },
    {
      "apiVersion": "2020-02-02",
      "kind": "web",
      "location": "japaneast",
      "name": "[parameters('components_conversation_logger_py_name')]",
      "properties": {
        "Application_Type": "web",
        "IngestionMode": "LogAnalytics",
        "RetentionInDays": 90,
        "WorkspaceResourceId": "[parameters('workspaces_default_workspace_externalid')]",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled"
      },
      "type": "microsoft.insights/components"
    },
    {
      "apiVersion": "2020-02-02",
      "kind": "web",
      "location": "japaneast",
      "name": "[parameters('components_memory_generator_name')]",
      "properties": {
        "Application_Type": "web",
        "IngestionMode": "LogAnalytics",
        "RetentionInDays": 90,
        "WorkspaceResourceId": "[parameters('workspaces_default_workspace_externalid')]",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled"
      },
      "type": "microsoft.insights/components"
    },
    {
      "apiVersion": "2024-12-01-preview",
      "location": "eastasia",
      "name": "[parameters('vaults_YOUR_KEY_VAULT_name')]",
      "properties": {
        "accessPolicies": [
          {
            "objectId": "YOUR_OBJECT_ID",
            "permissions": {
              "certificates": [],
              "keys": [],
              "secrets": [
                "Get",
                "List"
              ]
            },
            "tenantId": "YOUR_TENANT_ID"
          }
        ],
        "enableRbacAuthorization": true,
        "enableSoftDelete": true,
        "enabledForDeployment": false,
        "enabledForDiskEncryption": false,
        "enabledForTemplateDeployment": false,
        "networkAcls": {
          "bypass": "None",
          "defaultAction": "Allow",
          "ipRules": [],
          "virtualNetworkRules": []
        },
        "provisioningState": "Succeeded",
        "publicNetworkAccess": "Enabled",
        "sku": {
          "family": "A",
          "name": "Standard"
        },
        "softDeleteRetentionInDays": 90,
        "tenantId": "YOUR_TENANT_ID",
        "vaultUri": "https://YOUR_KEY_VAULT.vault.azure.net/"
      },
      "tags": {
        "Project": "Pokepal"
      },
      "type": "Microsoft.KeyVault/vaults"
    },
    {
      "apiVersion": "2025-01-01",
      "kind": "StorageV2",
      "location": "japaneast",
      "name": "[parameters('storageAccounts_storage_name')]",
      "properties": {
        "accessTier": "Hot",
        "allowBlobPublicAccess": false,
        "allowCrossTenantReplication": false,
        "allowSharedKeyAccess": true,
        "defaultToOAuthAuthentication": false,
        "dnsEndpointType": "Standard",
        "encryption": {
          "keySource": "Microsoft.Storage",
          "requireInfrastructureEncryption": false,
          "services": {
            "blob": {
              "enabled": true,
              "keyType": "Account"
            },
            "file": {
              "enabled": true,
              "keyType": "Account"
            }
          }
        },
        "largeFileSharesState": "Enabled",
        "minimumTlsVersion": "TLS1_2",
        "networkAcls": {
          "bypass": "AzureServices",
          "defaultAction": "Allow",
          "ipRules": [],
          "virtualNetworkRules": []
        },
        "publicNetworkAccess": "Enabled",
        "supportsHttpsTrafficOnly": true
      },
      "sku": {
        "name": "Standard_RAGRS",
        "tier": "Standard"
      },
      "type": "Microsoft.Storage/storageAccounts"
    },
    {
      "apiVersion": "2024-11-01",
      "kind": "functionapp",
      "location": "Japan East",
      "name": "[parameters('serverfarms_JapanEastLinuxDynamicPlan_name')]",
      "properties": {
        "asyncScalingEnabled": false,
        "elasticScaleEnabled": false,
        "hyperV": false,
        "isSpot": false,
        "isXenon": false,
        "maximumElasticWorkerCount": 1,
        "perSiteScaling": false,
        "reserved": true,
        "targetWorkerCount": 0,
        "targetWorkerSizeId": 0,
        "zoneRedundant": false
      },
      "sku": {
        "capacity": 0,
        "family": "Y",
        "name": "Y1",
        "size": "Y1",
        "tier": "Dynamic"
      },
      "type": "Microsoft.Web/serverfarms"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.ContainerRegistry/registries', parameters('registries_YOUR_ACR_NAME_name'))]"
      ],
      "name": "[concat(parameters('registries_YOUR_ACR_NAME_name'), '/_repositories_admin')]",
      "properties": {
        "actions": [
          "repositories/*/metadata/read",
          "repositories/*/metadata/write",
          "repositories/*/content/read",
          "repositories/*/content/write",
          "repositories/*/content/delete"
        ],
        "description": "Can perform all read, write and delete operations on the registry"
      },
      "type": "Microsoft.ContainerRegistry/registries/scopeMaps"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.ContainerRegistry/registries', parameters('registries_YOUR_ACR_NAME_name'))]"
      ],
      "name": "[concat(parameters('registries_YOUR_ACR_NAME_name'), '/_repositories_pull')]",
      "properties": {
        "actions": [
          "repositories/*/content/read"
        ],
        "description": "Can pull any repository of the registry"
      },
      "type": "Microsoft.ContainerRegistry/registries/scopeMaps"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.ContainerRegistry/registries', parameters('registries_YOUR_ACR_NAME_name'))]"
      ],
      "name": "[concat(parameters('registries_YOUR_ACR_NAME_name'), '/_repositories_pull_metadata_read')]",
      "properties": {
        "actions": [
          "repositories/*/content/read",
          "repositories/*/metadata/read"
        ],
        "description": "Can perform all read operations on the registry"
      },
      "type": "Microsoft.ContainerRegistry/registries/scopeMaps"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.ContainerRegistry/registries', parameters('registries_YOUR_ACR_NAME_name'))]"
      ],
      "name": "[concat(parameters('registries_YOUR_ACR_NAME_name'), '/_repositories_push')]",
      "properties": {
        "actions": [
          "repositories/*/content/read",
          "repositories/*/content/write"
        ],
        "description": "Can push to any repository of the registry"
      },
      "type": "Microsoft.ContainerRegistry/registries/scopeMaps"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.ContainerRegistry/registries', parameters('registries_YOUR_ACR_NAME_name'))]"
      ],
      "name": "[concat(parameters('registries_YOUR_ACR_NAME_name'), '/_repositories_push_metadata_write')]",
      "properties": {
        "actions": [
          "repositories/*/metadata/read",
          "repositories/*/metadata/write",
          "repositories/*/content/read",
          "repositories/*/content/write"
        ],
        "description": "Can perform all read and write operations on the registry"
      },
      "type": "Microsoft.ContainerRegistry/registries/scopeMaps"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/00000000-0000-0000-0000-000000000003')]",
      "properties": {
        "assignableScopes": [
          "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
        ],
        "permissions": [
          {
            "dataActions": [
              "Microsoft.DocumentDB/databaseAccounts/readMetadata",
              "Microsoft.DocumentDB/databaseAccounts/throughputSettings/read",
              "Microsoft.DocumentDB/databaseAccounts/cassandra/containers/executeQuery",
              "Microsoft.DocumentDB/databaseAccounts/cassandra/containers/readChangeFeed",
              "Microsoft.DocumentDB/databaseAccounts/cassandra/containers/entities/read"
            ],
            "notDataActions": []
          }
        ],
        "roleName": "Cosmos DB Built-in Data Reader",
        "type": "BuiltInRole"
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/cassandraRoleDefinitions"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/00000000-0000-0000-0000-000000000004')]",
      "properties": {
        "assignableScopes": [
          "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
        ],
        "permissions": [
          {
            "dataActions": [
              "Microsoft.DocumentDB/databaseAccounts/readMetadata",
              "Microsoft.DocumentDB/databaseAccounts/throughputSettings/read",
              "Microsoft.DocumentDB/databaseAccounts/throughputSettings/write",
              "Microsoft.DocumentDB/databaseAccounts/cassandra/*",
              "Microsoft.DocumentDB/databaseAccounts/cassandra/write",
              "Microsoft.DocumentDB/databaseAccounts/cassandra/delete",
              "Microsoft.DocumentDB/databaseAccounts/cassandra/containers/*",
              "Microsoft.DocumentDB/databaseAccounts/cassandra/containers/entities/*"
            ],
            "notDataActions": []
          }
        ],
        "roleName": "Cosmos DB Built-in Data Contributor",
        "type": "BuiltInRole"
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/cassandraRoleDefinitions"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/00000000-0000-0000-0000-000000000003')]",
      "properties": {
        "assignableScopes": [
          "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
        ],
        "permissions": [
          {
            "dataActions": [
              "Microsoft.DocumentDB/databaseAccounts/readMetadata",
              "Microsoft.DocumentDB/databaseAccounts/throughputSettings/read",
              "Microsoft.DocumentDB/databaseAccounts/gremlin/containers/executeQuery",
              "Microsoft.DocumentDB/databaseAccounts/gremlin/containers/readChangeFeed",
              "Microsoft.DocumentDB/databaseAccounts/gremlin/containers/entities/read"
            ],
            "notDataActions": []
          }
        ],
        "roleName": "Cosmos DB Built-in Data Reader",
        "type": "BuiltInRole"
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/gremlinRoleDefinitions"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/00000000-0000-0000-0000-000000000004')]",
      "properties": {
        "assignableScopes": [
          "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
        ],
        "permissions": [
          {
            "dataActions": [
              "Microsoft.DocumentDB/databaseAccounts/readMetadata",
              "Microsoft.DocumentDB/databaseAccounts/throughputSettings/read",
              "Microsoft.DocumentDB/databaseAccounts/throughputSettings/write",
              "Microsoft.DocumentDB/databaseAccounts/gremlin/*",
              "Microsoft.DocumentDB/databaseAccounts/gremlin/write",
              "Microsoft.DocumentDB/databaseAccounts/gremlin/delete",
              "Microsoft.DocumentDB/databaseAccounts/gremlin/containers/*",
              "Microsoft.DocumentDB/databaseAccounts/gremlin/containers/entities/*"
            ],
            "notDataActions": []
          }
        ],
        "roleName": "Cosmos DB Built-in Data Contributor",
        "type": "BuiltInRole"
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/gremlinRoleDefinitions"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/00000000-0000-0000-0000-000000000003')]",
      "properties": {
        "assignableScopes": [
          "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
        ],
        "permissions": [
          {
            "dataActions": [
              "Microsoft.DocumentDB/databaseAccounts/readMetadata",
              "Microsoft.DocumentDB/databaseAccounts/throughputSettings/read",
              "Microsoft.DocumentDB/databaseAccounts/mongoMI/containers/executeQuery",
              "Microsoft.DocumentDB/databaseAccounts/mongoMI/containers/readChangeFeed",
              "Microsoft.DocumentDB/databaseAccounts/mongoMI/containers/entities/read"
            ],
            "notDataActions": []
          }
        ],
        "roleName": "Cosmos DB Built-in Data Reader",
        "type": "BuiltInRole"
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/mongoMIRoleDefinitions"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/00000000-0000-0000-0000-000000000004')]",
      "properties": {
        "assignableScopes": [
          "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
        ],
        "permissions": [
          {
            "dataActions": [
              "Microsoft.DocumentDB/databaseAccounts/readMetadata",
              "Microsoft.DocumentDB/databaseAccounts/throughputSettings/read",
              "Microsoft.DocumentDB/databaseAccounts/throughputSettings/write",
              "Microsoft.DocumentDB/databaseAccounts/mongoMI/*",
              "Microsoft.DocumentDB/databaseAccounts/mongoMI/write",
              "Microsoft.DocumentDB/databaseAccounts/mongoMI/delete",
              "Microsoft.DocumentDB/databaseAccounts/mongoMI/containers/*",
              "Microsoft.DocumentDB/databaseAccounts/mongoMI/containers/entities/*"
            ],
            "notDataActions": []
          }
        ],
        "roleName": "Cosmos DB Built-in Data Contributor",
        "type": "BuiltInRole"
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/mongoMIRoleDefinitions"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/YOUR_DATABASE_NAME')]",
      "properties": {
        "resource": {
          "id": "YOUR_DATABASE_NAME"
        }
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/00000000-0000-0000-0000-000000000001')]",
      "properties": {
        "assignableScopes": [
          "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
        ],
        "permissions": [
          {
            "dataActions": [
              "Microsoft.DocumentDB/databaseAccounts/readMetadata",
              "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/executeQuery",
              "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/readChangeFeed",
              "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/items/read"
            ],
            "notDataActions": []
          }
        ],
        "roleName": "Cosmos DB Built-in Data Reader",
        "type": "BuiltInRole"
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/sqlRoleDefinitions"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/00000000-0000-0000-0000-000000000002')]",
      "properties": {
        "assignableScopes": [
          "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
        ],
        "permissions": [
          {
            "dataActions": [
              "Microsoft.DocumentDB/databaseAccounts/readMetadata",
              "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/*",
              "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/items/*"
            ],
            "notDataActions": []
          }
        ],
        "roleName": "Cosmos DB Built-in Data Contributor",
        "type": "BuiltInRole"
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/sqlRoleDefinitions"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/00000000-0000-0000-0000-000000000001')]",
      "properties": {
        "assignableScopes": [
          "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
        ],
        "permissions": [
          {
            "dataActions": [
              "Microsoft.DocumentDB/databaseAccounts/readMetadata",
              "Microsoft.DocumentDB/databaseAccounts/tables/containers/executeQuery",
              "Microsoft.DocumentDB/databaseAccounts/tables/containers/readChangeFeed",
              "Microsoft.DocumentDB/databaseAccounts/tables/containers/entities/read"
            ],
            "notDataActions": []
          }
        ],
        "roleName": "Cosmos DB Built-in Data Reader",
        "type": "BuiltInRole"
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/tableRoleDefinitions"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/00000000-0000-0000-0000-000000000002')]",
      "properties": {
        "assignableScopes": [
          "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
        ],
        "permissions": [
          {
            "dataActions": [
              "Microsoft.DocumentDB/databaseAccounts/readMetadata",
              "Microsoft.DocumentDB/databaseAccounts/tables/*",
              "Microsoft.DocumentDB/databaseAccounts/tables/containers/*",
              "Microsoft.DocumentDB/databaseAccounts/tables/containers/entities/*"
            ],
            "notDataActions": []
          }
        ],
        "roleName": "Cosmos DB Built-in Data Contributor",
        "type": "BuiltInRole"
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/tableRoleDefinitions"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_name'), '/degradationindependencyduration')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Degradation in dependency duration",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "degradationindependencyduration",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_py_name'), '/degradationindependencyduration')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Degradation in dependency duration",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "degradationindependencyduration",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_memory_generator_name'), '/degradationindependencyduration')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Degradation in dependency duration",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "degradationindependencyduration",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_name'), '/degradationinserverresponsetime')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Degradation in server response time",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "degradationinserverresponsetime",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_py_name'), '/degradationinserverresponsetime')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Degradation in server response time",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "degradationinserverresponsetime",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_memory_generator_name'), '/degradationinserverresponsetime')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Degradation in server response time",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "degradationinserverresponsetime",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_name'), '/digestMailConfiguration')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This rule describes the digest mail preferences",
          "DisplayName": "Digest Mail Configuration",
          "HelpUrl": "https://docs.microsoft.com/azure/application-insights",
          "IsEnabledByDefault": true,
          "IsHidden": true,
          "IsInPreview": false,
          "Name": "digestMailConfiguration",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_py_name'), '/digestMailConfiguration')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This rule describes the digest mail preferences",
          "DisplayName": "Digest Mail Configuration",
          "HelpUrl": "https://docs.microsoft.com/azure/application-insights",
          "IsEnabledByDefault": true,
          "IsHidden": true,
          "IsInPreview": false,
          "Name": "digestMailConfiguration",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_memory_generator_name'), '/digestMailConfiguration')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This rule describes the digest mail preferences",
          "DisplayName": "Digest Mail Configuration",
          "HelpUrl": "https://docs.microsoft.com/azure/application-insights",
          "IsEnabledByDefault": true,
          "IsHidden": true,
          "IsInPreview": false,
          "Name": "digestMailConfiguration",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_name'), '/extension_billingdatavolumedailyspikeextension')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the billing data generated by your application, and can warn you about an unusual increase in your application's billing costs",
          "DisplayName": "Abnormal rise in daily data volume (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/tree/master/SmartDetection/billing-data-volume-daily-spike.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_billingdatavolumedailyspikeextension",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_py_name'), '/extension_billingdatavolumedailyspikeextension')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the billing data generated by your application, and can warn you about an unusual increase in your application's billing costs",
          "DisplayName": "Abnormal rise in daily data volume (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/tree/master/SmartDetection/billing-data-volume-daily-spike.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_billingdatavolumedailyspikeextension",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_memory_generator_name'), '/extension_billingdatavolumedailyspikeextension')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the billing data generated by your application, and can warn you about an unusual increase in your application's billing costs",
          "DisplayName": "Abnormal rise in daily data volume (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/tree/master/SmartDetection/billing-data-volume-daily-spike.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_billingdatavolumedailyspikeextension",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_name'), '/extension_canaryextension')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Canary extension",
          "DisplayName": "Canary extension",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/blob/master/SmartDetection/",
          "IsEnabledByDefault": true,
          "IsHidden": true,
          "IsInPreview": true,
          "Name": "extension_canaryextension",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_py_name'), '/extension_canaryextension')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Canary extension",
          "DisplayName": "Canary extension",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/blob/master/SmartDetection/",
          "IsEnabledByDefault": true,
          "IsHidden": true,
          "IsInPreview": true,
          "Name": "extension_canaryextension",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_memory_generator_name'), '/extension_canaryextension')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Canary extension",
          "DisplayName": "Canary extension",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/blob/master/SmartDetection/",
          "IsEnabledByDefault": true,
          "IsHidden": true,
          "IsInPreview": true,
          "Name": "extension_canaryextension",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_name'), '/extension_exceptionchangeextension')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the exceptions thrown in your application, and can warn you about unusual patterns in your exception telemetry.",
          "DisplayName": "Abnormal rise in exception volume (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/blob/master/SmartDetection/abnormal-rise-in-exception-volume.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_exceptionchangeextension",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_py_name'), '/extension_exceptionchangeextension')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the exceptions thrown in your application, and can warn you about unusual patterns in your exception telemetry.",
          "DisplayName": "Abnormal rise in exception volume (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/blob/master/SmartDetection/abnormal-rise-in-exception-volume.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_exceptionchangeextension",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_memory_generator_name'), '/extension_exceptionchangeextension')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the exceptions thrown in your application, and can warn you about unusual patterns in your exception telemetry.",
          "DisplayName": "Abnormal rise in exception volume (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/blob/master/SmartDetection/abnormal-rise-in-exception-volume.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_exceptionchangeextension",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_name'), '/extension_memoryleakextension')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the memory consumption of each process in your application, and can warn you about potential memory leaks or increased memory consumption.",
          "DisplayName": "Potential memory leak detected (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/tree/master/SmartDetection/memory-leak.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_memoryleakextension",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_py_name'), '/extension_memoryleakextension')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the memory consumption of each process in your application, and can warn you about potential memory leaks or increased memory consumption.",
          "DisplayName": "Potential memory leak detected (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/tree/master/SmartDetection/memory-leak.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_memoryleakextension",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_memory_generator_name'), '/extension_memoryleakextension')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the memory consumption of each process in your application, and can warn you about potential memory leaks or increased memory consumption.",
          "DisplayName": "Potential memory leak detected (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/tree/master/SmartDetection/memory-leak.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_memoryleakextension",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_name'), '/extension_securityextensionspackage')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the telemetry generated by your application and detects potential security issues.",
          "DisplayName": "Potential security issue detected (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/blob/master/SmartDetection/application-security-detection-pack.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_securityextensionspackage",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_py_name'), '/extension_securityextensionspackage')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the telemetry generated by your application and detects potential security issues.",
          "DisplayName": "Potential security issue detected (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/blob/master/SmartDetection/application-security-detection-pack.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_securityextensionspackage",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_memory_generator_name'), '/extension_securityextensionspackage')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the telemetry generated by your application and detects potential security issues.",
          "DisplayName": "Potential security issue detected (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/blob/master/SmartDetection/application-security-detection-pack.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_securityextensionspackage",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_name'), '/extension_traceseveritydetector')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the trace logs emitted from your application, and can warn you about unusual patterns in the severity of your trace telemetry.",
          "DisplayName": "Degradation in trace severity ratio (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/blob/master/SmartDetection/degradation-in-trace-severity-ratio.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_traceseveritydetector",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_py_name'), '/extension_traceseveritydetector')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the trace logs emitted from your application, and can warn you about unusual patterns in the severity of your trace telemetry.",
          "DisplayName": "Degradation in trace severity ratio (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/blob/master/SmartDetection/degradation-in-trace-severity-ratio.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_traceseveritydetector",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_memory_generator_name'), '/extension_traceseveritydetector')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "This detection rule automatically analyzes the trace logs emitted from your application, and can warn you about unusual patterns in the severity of your trace telemetry.",
          "DisplayName": "Degradation in trace severity ratio (preview)",
          "HelpUrl": "https://github.com/Microsoft/ApplicationInsights-Home/blob/master/SmartDetection/degradation-in-trace-severity-ratio.md",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": true,
          "Name": "extension_traceseveritydetector",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_name'), '/longdependencyduration')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Long dependency duration",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "longdependencyduration",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_py_name'), '/longdependencyduration')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Long dependency duration",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "longdependencyduration",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_memory_generator_name'), '/longdependencyduration')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Long dependency duration",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "longdependencyduration",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_name'), '/migrationToAlertRulesCompleted')]",
      "properties": {
        "customEmails": [],
        "enabled": false,
        "ruleDefinitions": {
          "Description": "A configuration that controls the migration state of Smart Detection to Smart Alerts",
          "DisplayName": "Migration To Alert Rules Completed",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": false,
          "IsHidden": true,
          "IsInPreview": true,
          "Name": "migrationToAlertRulesCompleted",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_py_name'), '/migrationToAlertRulesCompleted')]",
      "properties": {
        "customEmails": [],
        "enabled": false,
        "ruleDefinitions": {
          "Description": "A configuration that controls the migration state of Smart Detection to Smart Alerts",
          "DisplayName": "Migration To Alert Rules Completed",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": false,
          "IsHidden": true,
          "IsInPreview": true,
          "Name": "migrationToAlertRulesCompleted",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_memory_generator_name'), '/migrationToAlertRulesCompleted')]",
      "properties": {
        "customEmails": [],
        "enabled": false,
        "ruleDefinitions": {
          "Description": "A configuration that controls the migration state of Smart Detection to Smart Alerts",
          "DisplayName": "Migration To Alert Rules Completed",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": false,
          "IsHidden": true,
          "IsInPreview": true,
          "Name": "migrationToAlertRulesCompleted",
          "SupportsEmailNotifications": false
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_name'), '/slowpageloadtime')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Slow page load time",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "slowpageloadtime",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_py_name'), '/slowpageloadtime')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Slow page load time",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "slowpageloadtime",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_memory_generator_name'), '/slowpageloadtime')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Slow page load time",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "slowpageloadtime",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_name'), '/slowserverresponsetime')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Slow server response time",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "slowserverresponsetime",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_conversation_logger_py_name'), '/slowserverresponsetime')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Slow server response time",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "slowserverresponsetime",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2018-05-01-preview",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
      ],
      "location": "japaneast",
      "name": "[concat(parameters('components_memory_generator_name'), '/slowserverresponsetime')]",
      "properties": {
        "customEmails": [],
        "enabled": true,
        "ruleDefinitions": {
          "Description": "Smart Detection rules notify you of performance anomaly issues.",
          "DisplayName": "Slow server response time",
          "HelpUrl": "https://docs.microsoft.com/en-us/azure/application-insights/app-insights-proactive-performance-diagnostics",
          "IsEnabledByDefault": true,
          "IsHidden": false,
          "IsInPreview": false,
          "Name": "slowserverresponsetime",
          "SupportsEmailNotifications": true
        },
        "sendEmailsToSubscriptionOwners": true
      },
      "type": "microsoft.insights/components/ProactiveDetectionConfigs"
    },
    {
      "apiVersion": "2024-12-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.KeyVault/vaults', parameters('vaults_YOUR_KEY_VAULT_name'))]"
      ],
      "location": "eastasia",
      "name": "[concat(parameters('vaults_YOUR_KEY_VAULT_name'), '/azure-speech-key')]",
      "properties": {
        "attributes": {
          "enabled": true
        }
      },
      "tags": {
        "file-encoding": "utf-8"
      },
      "type": "Microsoft.KeyVault/vaults/secrets"
    },
    {
      "apiVersion": "2024-12-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.KeyVault/vaults', parameters('vaults_YOUR_KEY_VAULT_name'))]"
      ],
      "location": "eastasia",
      "name": "[concat(parameters('vaults_YOUR_KEY_VAULT_name'), '/azure-speech-region')]",
      "properties": {
        "attributes": {
          "enabled": true
        }
      },
      "tags": {
        "file-encoding": "utf-8"
      },
      "type": "Microsoft.KeyVault/vaults/secrets"
    },
    {
      "apiVersion": "2024-12-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.KeyVault/vaults', parameters('vaults_YOUR_KEY_VAULT_name'))]"
      ],
      "location": "eastasia",
      "name": "[concat(parameters('vaults_YOUR_KEY_VAULT_name'), '/cosmos-connection-string')]",
      "properties": {
        "attributes": {
          "enabled": true
        }
      },
      "tags": {
        "file-encoding": "utf-8"
      },
      "type": "Microsoft.KeyVault/vaults/secrets"
    },
    {
      "apiVersion": "2024-12-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.KeyVault/vaults', parameters('vaults_YOUR_KEY_VAULT_name'))]"
      ],
      "location": "eastasia",
      "name": "[concat(parameters('vaults_YOUR_KEY_VAULT_name'), '/openai-api-key')]",
      "properties": {
        "attributes": {
          "enabled": true
        }
      },
      "tags": {
        "file-encoding": "utf-8"
      },
      "type": "Microsoft.KeyVault/vaults/secrets"
    },
    {
      "apiVersion": "2024-12-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.KeyVault/vaults', parameters('vaults_YOUR_KEY_VAULT_name'))]"
      ],
      "location": "eastasia",
      "name": "[concat(parameters('vaults_YOUR_KEY_VAULT_name'), '/YOUR_ACR_PASSWORD')]",
      "properties": {
        "attributes": {
          "enabled": true
        }
      },
      "tags": {
        "file-encoding": "utf-8"
      },
      "type": "Microsoft.KeyVault/vaults/secrets"
    },
    {
      "apiVersion": "2024-12-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.KeyVault/vaults', parameters('vaults_YOUR_KEY_VAULT_name'))]"
      ],
      "location": "eastasia",
      "name": "[concat(parameters('vaults_YOUR_KEY_VAULT_name'), '/storage-connection-string')]",
      "properties": {
        "attributes": {
          "enabled": true
        }
      },
      "tags": {
        "file-encoding": "utf-8"
      },
      "type": "Microsoft.KeyVault/vaults/secrets"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default')]",
      "properties": {
        "containerDeleteRetentionPolicy": {
          "days": 7,
          "enabled": true
        },
        "cors": {
          "corsRules": []
        },
        "deleteRetentionPolicy": {
          "allowPermanentDelete": false,
          "days": 7,
          "enabled": true
        }
      },
      "sku": {
        "name": "Standard_RAGRS",
        "tier": "Standard"
      },
      "type": "Microsoft.Storage/storageAccounts/blobServices"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default')]",
      "properties": {
        "cors": {
          "corsRules": []
        },
        "protocolSettings": {
          "smb": {}
        },
        "shareDeleteRetentionPolicy": {
          "days": 7,
          "enabled": true
        }
      },
      "sku": {
        "name": "Standard_RAGRS",
        "tier": "Standard"
      },
      "type": "Microsoft.Storage/storageAccounts/fileServices"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default')]",
      "properties": {
        "cors": {
          "corsRules": []
        }
      },
      "type": "Microsoft.Storage/storageAccounts/queueServices"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default')]",
      "properties": {
        "cors": {
          "corsRules": []
        }
      },
      "type": "Microsoft.Storage/storageAccounts/tableServices"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarms_JapanEastLinuxDynamicPlan_name'))]"
      ],
      "identity": {
        "type": "SystemAssigned"
      },
      "kind": "functionapp,linux",
      "location": "Japan East",
      "name": "[parameters('sites_conversation_logger_py_name')]",
      "properties": {
        "clientAffinityEnabled": false,
        "clientAffinityProxyEnabled": false,
        "clientCertEnabled": false,
        "clientCertMode": "Required",
        "containerSize": 0,
        "customDomainVerificationId": "09E2B5F44869F99C687EB6C3B8007950FA3F70C8B55F8265204D44B0E04511B3",
        "dailyMemoryTimeQuota": 0,
        "dnsConfiguration": {},
        "enabled": true,
        "endToEndEncryptionEnabled": false,
        "hostNameSslStates": [
          {
            "hostType": "Standard",
            "name": "[concat(parameters('sites_conversation_logger_py_name'), '.azurewebsites.net')]",
            "sslState": "Disabled"
          },
          {
            "hostType": "Repository",
            "name": "[concat(parameters('sites_conversation_logger_py_name'), '.scm.azurewebsites.net')]",
            "sslState": "Disabled"
          }
        ],
        "hostNamesDisabled": false,
        "httpsOnly": true,
        "hyperV": false,
        "ipMode": "IPv4",
        "isXenon": false,
        "keyVaultReferenceIdentity": "SystemAssigned",
        "outboundVnetRouting": {
          "allTraffic": false,
          "applicationTraffic": false,
          "backupRestoreTraffic": false,
          "contentShareTraffic": false,
          "imagePullTraffic": false
        },
        "publicNetworkAccess": "Enabled",
        "redundancyMode": "None",
        "reserved": true,
        "scmSiteAlsoStopped": false,
        "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarms_JapanEastLinuxDynamicPlan_name'))]",
        "siteConfig": {
          "acrUseManagedIdentityCreds": false,
          "alwaysOn": false,
          "functionAppScaleLimit": 200,
          "http20Enabled": true,
          "linuxFxVersion": "Python|3.11",
          "minimumElasticInstanceCount": 1,
          "numberOfWorkers": 1
        },
        "storageAccountRequired": false
      },
      "tags": {
        "hidden-link: /app-insights-resource-id": "/subscriptions/YOUR_SUBSCRIPTION_ID/resourceGroups/YOUR_RESOURCE_GROUP/providers/microsoft.insights/components/YOUR_CONVERSATION_LOGGER"
      },
      "type": "Microsoft.Web/sites"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarms_JapanEastLinuxDynamicPlan_name'))]"
      ],
      "identity": {
        "type": "SystemAssigned"
      },
      "kind": "functionapp,linux",
      "location": "Japan East",
      "name": "[parameters('sites_memory_generator_name')]",
      "properties": {
        "clientAffinityEnabled": false,
        "clientAffinityProxyEnabled": false,
        "clientCertEnabled": false,
        "clientCertMode": "Required",
        "containerSize": 0,
        "customDomainVerificationId": "09E2B5F44869F99C687EB6C3B8007950FA3F70C8B55F8265204D44B0E04511B3",
        "dailyMemoryTimeQuota": 0,
        "dnsConfiguration": {},
        "enabled": true,
        "endToEndEncryptionEnabled": false,
        "hostNameSslStates": [
          {
            "hostType": "Standard",
            "name": "[concat(parameters('sites_memory_generator_name'), '.azurewebsites.net')]",
            "sslState": "Disabled"
          },
          {
            "hostType": "Repository",
            "name": "[concat(parameters('sites_memory_generator_name'), '.scm.azurewebsites.net')]",
            "sslState": "Disabled"
          }
        ],
        "hostNamesDisabled": false,
        "httpsOnly": true,
        "hyperV": false,
        "ipMode": "IPv4",
        "isXenon": false,
        "keyVaultReferenceIdentity": "SystemAssigned",
        "outboundVnetRouting": {
          "allTraffic": false,
          "applicationTraffic": false,
          "backupRestoreTraffic": false,
          "contentShareTraffic": false,
          "imagePullTraffic": false
        },
        "publicNetworkAccess": "Enabled",
        "redundancyMode": "None",
        "reserved": true,
        "scmSiteAlsoStopped": false,
        "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarms_JapanEastLinuxDynamicPlan_name'))]",
        "siteConfig": {
          "acrUseManagedIdentityCreds": false,
          "alwaysOn": false,
          "functionAppScaleLimit": 200,
          "http20Enabled": true,
          "linuxFxVersion": "Python|3.11",
          "minimumElasticInstanceCount": 1,
          "numberOfWorkers": 1
        },
        "storageAccountRequired": false
      },
      "tags": {
        "hidden-link: /app-insights-resource-id": "/subscriptions/YOUR_SUBSCRIPTION_ID/resourceGroups/YOUR_RESOURCE_GROUP/providers/microsoft.insights/components/YOUR_MEMORY_GENERATOR"
      },
      "type": "Microsoft.Web/sites"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_conversation_logger_py_name'))]"
      ],
      "location": "Japan East",
      "name": "[concat(parameters('sites_conversation_logger_py_name'), '/ftp')]",
      "properties": {
        "allow": true
      },
      "tags": {
        "hidden-link: /app-insights-resource-id": "/subscriptions/YOUR_SUBSCRIPTION_ID/resourceGroups/YOUR_RESOURCE_GROUP/providers/microsoft.insights/components/YOUR_CONVERSATION_LOGGER"
      },
      "type": "Microsoft.Web/sites/basicPublishingCredentialsPolicies"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_memory_generator_name'))]"
      ],
      "location": "Japan East",
      "name": "[concat(parameters('sites_memory_generator_name'), '/ftp')]",
      "properties": {
        "allow": true
      },
      "tags": {
        "hidden-link: /app-insights-resource-id": "/subscriptions/YOUR_SUBSCRIPTION_ID/resourceGroups/YOUR_RESOURCE_GROUP/providers/microsoft.insights/components/YOUR_MEMORY_GENERATOR"
      },
      "type": "Microsoft.Web/sites/basicPublishingCredentialsPolicies"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_conversation_logger_py_name'))]"
      ],
      "location": "Japan East",
      "name": "[concat(parameters('sites_conversation_logger_py_name'), '/scm')]",
      "properties": {
        "allow": true
      },
      "tags": {
        "hidden-link: /app-insights-resource-id": "/subscriptions/YOUR_SUBSCRIPTION_ID/resourceGroups/YOUR_RESOURCE_GROUP/providers/microsoft.insights/components/YOUR_CONVERSATION_LOGGER"
      },
      "type": "Microsoft.Web/sites/basicPublishingCredentialsPolicies"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_memory_generator_name'))]"
      ],
      "location": "Japan East",
      "name": "[concat(parameters('sites_memory_generator_name'), '/scm')]",
      "properties": {
        "allow": true
      },
      "tags": {
        "hidden-link: /app-insights-resource-id": "/subscriptions/YOUR_SUBSCRIPTION_ID/resourceGroups/YOUR_RESOURCE_GROUP/providers/microsoft.insights/components/YOUR_MEMORY_GENERATOR"
      },
      "type": "Microsoft.Web/sites/basicPublishingCredentialsPolicies"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_conversation_logger_py_name'))]"
      ],
      "location": "Japan East",
      "name": "[concat(parameters('sites_conversation_logger_py_name'), '/web')]",
      "properties": {
        "acrUseManagedIdentityCreds": false,
        "alwaysOn": false,
        "autoHealEnabled": false,
        "azureStorageAccounts": {},
        "defaultDocuments": [
          "Default.htm",
          "Default.html",
          "Default.asp",
          "index.htm",
          "index.html",
          "iisstart.htm",
          "default.aspx",
          "index.php"
        ],
        "detailedErrorLoggingEnabled": false,
        "experiments": {
          "rampUpRules": []
        },
        "ftpsState": "FtpsOnly",
        "functionAppScaleLimit": 200,
        "functionsRuntimeScaleMonitoringEnabled": false,
        "http20Enabled": true,
        "http20ProxyFlag": 0,
        "httpLoggingEnabled": false,
        "ipSecurityRestrictions": [
          {
            "action": "Allow",
            "description": "Allow all access",
            "ipAddress": "Any",
            "name": "Allow all",
            "priority": 2147483647
          }
        ],
        "linuxFxVersion": "Python|3.11",
        "loadBalancing": "LeastRequests",
        "localMySqlEnabled": false,
        "logsDirectorySizeLimit": 35,
        "managedPipelineMode": "Integrated",
        "managedServiceIdentityId": 25735,
        "minTlsVersion": "1.2",
        "minimumElasticInstanceCount": 1,
        "netFrameworkVersion": "v4.0",
        "numberOfWorkers": 1,
        "preWarmedInstanceCount": 0,
        "publicNetworkAccess": "Enabled",
        "publishingUsername": "$YOUR_CONVERSATION_LOGGER",
        "remoteDebuggingEnabled": false,
        "requestTracingEnabled": false,
        "scmIpSecurityRestrictions": [
          {
            "action": "Allow",
            "description": "Allow all access",
            "ipAddress": "Any",
            "name": "Allow all",
            "priority": 2147483647
          }
        ],
        "scmIpSecurityRestrictionsUseMain": false,
        "scmMinTlsVersion": "1.2",
        "scmType": "None",
        "use32BitWorkerProcess": false,
        "virtualApplications": [
          {
            "physicalPath": "site\\wwwroot",
            "preloadEnabled": false,
            "virtualPath": "/"
          }
        ],
        "vnetPrivatePortsCount": 0,
        "vnetRouteAllEnabled": false,
        "webSocketsEnabled": false
      },
      "tags": {
        "hidden-link: /app-insights-resource-id": "/subscriptions/YOUR_SUBSCRIPTION_ID/resourceGroups/YOUR_RESOURCE_GROUP/providers/microsoft.insights/components/YOUR_CONVERSATION_LOGGER"
      },
      "type": "Microsoft.Web/sites/config"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_memory_generator_name'))]"
      ],
      "location": "Japan East",
      "name": "[concat(parameters('sites_memory_generator_name'), '/web')]",
      "properties": {
        "acrUseManagedIdentityCreds": false,
        "alwaysOn": false,
        "autoHealEnabled": false,
        "azureStorageAccounts": {},
        "defaultDocuments": [
          "Default.htm",
          "Default.html",
          "Default.asp",
          "index.htm",
          "index.html",
          "iisstart.htm",
          "default.aspx",
          "index.php"
        ],
        "detailedErrorLoggingEnabled": false,
        "experiments": {
          "rampUpRules": []
        },
        "ftpsState": "FtpsOnly",
        "functionAppScaleLimit": 200,
        "functionsRuntimeScaleMonitoringEnabled": false,
        "http20Enabled": true,
        "http20ProxyFlag": 0,
        "httpLoggingEnabled": false,
        "ipSecurityRestrictions": [
          {
            "action": "Allow",
            "description": "Allow all access",
            "ipAddress": "Any",
            "name": "Allow all",
            "priority": 2147483647
          }
        ],
        "linuxFxVersion": "Python|3.11",
        "loadBalancing": "LeastRequests",
        "localMySqlEnabled": false,
        "logsDirectorySizeLimit": 35,
        "managedPipelineMode": "Integrated",
        "managedServiceIdentityId": 25736,
        "minTlsVersion": "1.2",
        "minimumElasticInstanceCount": 1,
        "netFrameworkVersion": "v4.0",
        "numberOfWorkers": 1,
        "preWarmedInstanceCount": 0,
        "publicNetworkAccess": "Enabled",
        "publishingUsername": "$YOUR_MEMORY_GENERATOR",
        "remoteDebuggingEnabled": false,
        "remoteDebuggingVersion": "VS2022",
        "requestTracingEnabled": false,
        "scmIpSecurityRestrictions": [
          {
            "action": "Allow",
            "description": "Allow all access",
            "ipAddress": "Any",
            "name": "Allow all",
            "priority": 2147483647
          }
        ],
        "scmIpSecurityRestrictionsUseMain": false,
        "scmMinTlsVersion": "1.2",
        "scmType": "LocalGit",
        "use32BitWorkerProcess": false,
        "virtualApplications": [
          {
            "physicalPath": "site\\wwwroot",
            "preloadEnabled": false,
            "virtualPath": "/"
          }
        ],
        "vnetPrivatePortsCount": 0,
        "vnetRouteAllEnabled": false,
        "webSocketsEnabled": false
      },
      "tags": {
        "hidden-link: /app-insights-resource-id": "/subscriptions/YOUR_SUBSCRIPTION_ID/resourceGroups/YOUR_RESOURCE_GROUP/providers/microsoft.insights/components/YOUR_MEMORY_GENERATOR"
      },
      "type": "Microsoft.Web/sites/config"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_conversation_logger_py_name'))]"
      ],
      "location": "Japan East",
      "name": "[concat(parameters('sites_conversation_logger_py_name'), '/conversation_logger')]",
      "properties": {
        "config": {
          "bindings": [
            {
              "connection": "EventHubConnectionString",
              "consumerGroup": "conversationlogger",
              "direction": "IN",
              "eventHubName": "YOUR_IOT_HUB_NAME",
              "name": "events",
              "type": "eventHubTrigger"
            }
          ],
          "entryPoint": "conversation_logger",
          "functionDirectory": "/home/site/wwwroot",
          "language": "python",
          "name": "conversation_logger",
          "scriptFile": "function_app.py"
        },
        "isDisabled": false,
        "language": "python",
      },
      "type": "Microsoft.Web/sites/functions"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_conversation_logger_py_name'))]"
      ],
      "location": "Japan East",
      "name": "[concat(parameters('sites_conversation_logger_py_name'), '/conversation_restorer')]",
      "properties": {
        "config": {
          "bindings": [
            {
              "cardinality": "ONE",
              "connection": "EventHubConnectionString",
              "consumerGroup": "conversation-restore-group",
              "direction": "IN",
              "eventHubName": "YOUR_IOT_HUB_NAME",
              "name": "event",
              "type": "eventHubTrigger"
            }
          ],
          "entryPoint": "conversation_restorer",
          "functionDirectory": "/home/site/wwwroot",
          "language": "python",
          "name": "conversation_restorer",
          "scriptFile": "function_app.py"
        },
        "isDisabled": false,
        "language": "python",
      },
      "type": "Microsoft.Web/sites/functions"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_memory_generator_name'))]"
      ],
      "location": "Japan East",
      "name": "[concat(parameters('sites_memory_generator_name'), '/memory_generator')]",
      "properties": {
        "config": {
          "bindings": [
            {
              "direction": "IN",
              "name": "myTimer",
              "runOnStartup": false,
              "schedule": "0 10 * * * *",
              "type": "timerTrigger",
              "useMonitor": true
            }
          ],
          "entryPoint": "memory_generator",
          "functionDirectory": "/home/site/wwwroot",
          "language": "python",
          "name": "memory_generator",
          "scriptFile": "function_app.py"
        },
        "isDisabled": false,
        "language": "python",
      },
      "type": "Microsoft.Web/sites/functions"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_conversation_logger_py_name'))]"
      ],
      "location": "Japan East",
      "name": "[concat(parameters('sites_conversation_logger_py_name'), '/telemetry_logger')]",
      "properties": {
        "config": {
          "bindings": [
            {
              "connection": "EventHubConnectionString",
              "consumerGroup": "telemetrylogger",
              "direction": "IN",
              "eventHubName": "YOUR_IOT_HUB_NAME",
              "name": "events",
              "type": "eventHubTrigger"
            }
          ],
          "entryPoint": "telemetry_logger",
          "functionDirectory": "/home/site/wwwroot",
          "language": "python",
          "name": "telemetry_logger",
          "scriptFile": "function_app.py"
        },
        "isDisabled": false,
        "language": "python",
      },
      "type": "Microsoft.Web/sites/functions"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_conversation_logger_py_name'))]"
      ],
      "location": "Japan East",
      "name": "[concat(parameters('sites_conversation_logger_py_name'), '/', parameters('sites_conversation_logger_py_name'), '.azurewebsites.net')]",
      "properties": {
        "hostNameType": "Verified",
        "siteName": "YOUR_CONVERSATION_LOGGER"
      },
      "type": "Microsoft.Web/sites/hostNameBindings"
    },
    {
      "apiVersion": "2024-11-01",
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_memory_generator_name'))]"
      ],
      "location": "Japan East",
      "name": "[concat(parameters('sites_memory_generator_name'), '/', parameters('sites_memory_generator_name'), '.azurewebsites.net')]",
      "properties": {
        "hostNameType": "Verified",
        "siteName": "YOUR_MEMORY_GENERATOR"
      },
      "type": "Microsoft.Web/sites/hostNameBindings"
    },
    {
      "apiVersion": "2021-04-01",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]",
        "[resourceId('microsoft.insights/actionGroups', parameters('actionGroups_Application_Insights_Smart_Detection_name'))]"
      ],
      "location": "global",
      "name": "[parameters('smartdetectoralertrules_failure_anomalies_conversation_logger_name')]",
      "properties": {
        "actionGroups": {
          "groupIds": [
            "[resourceId('microsoft.insights/actionGroups', parameters('actionGroups_Application_Insights_Smart_Detection_name'))]"
          ]
        },
        "description": "Failure Anomalies notifies you of an unusual rise in the rate of failed HTTP requests or dependency calls.",
        "detector": {
          "id": "FailureAnomaliesDetector"
        },
        "frequency": "PT1M",
        "scope": [
          "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_name'))]"
        ],
        "severity": "Sev3",
        "state": "Enabled"
      },
      "type": "microsoft.alertsmanagement/smartdetectoralertrules"
    },
    {
      "apiVersion": "2021-04-01",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]",
        "[resourceId('microsoft.insights/actionGroups', parameters('actionGroups_Application_Insights_Smart_Detection_name'))]"
      ],
      "location": "global",
      "name": "[parameters('smartdetectoralertrules_failure_anomalies_conversation_logger_py_name')]",
      "properties": {
        "actionGroups": {
          "groupIds": [
            "[resourceId('microsoft.insights/actionGroups', parameters('actionGroups_Application_Insights_Smart_Detection_name'))]"
          ]
        },
        "description": "Failure Anomalies notifies you of an unusual rise in the rate of failed HTTP requests or dependency calls.",
        "detector": {
          "id": "FailureAnomaliesDetector"
        },
        "frequency": "PT1M",
        "scope": [
          "[resourceId('microsoft.insights/components', parameters('components_conversation_logger_py_name'))]"
        ],
        "severity": "Sev3",
        "state": "Enabled"
      },
      "type": "microsoft.alertsmanagement/smartdetectoralertrules"
    },
    {
      "apiVersion": "2021-04-01",
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]",
        "[resourceId('microsoft.insights/actionGroups', parameters('actionGroups_Application_Insights_Smart_Detection_name'))]"
      ],
      "location": "global",
      "name": "[parameters('smartdetectoralertrules_failure_anomalies_memory_generator_name')]",
      "properties": {
        "actionGroups": {
          "groupIds": [
            "[resourceId('microsoft.insights/actionGroups', parameters('actionGroups_Application_Insights_Smart_Detection_name'))]"
          ]
        },
        "description": "Failure Anomalies notifies you of an unusual rise in the rate of failed HTTP requests or dependency calls.",
        "detector": {
          "id": "FailureAnomaliesDetector"
        },
        "frequency": "PT1M",
        "scope": [
          "[resourceId('microsoft.insights/components', parameters('components_memory_generator_name'))]"
        ],
        "severity": "Sev3",
        "state": "Enabled"
      },
      "type": "microsoft.alertsmanagement/smartdetectoralertrules"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', parameters('databaseAccounts_cosmos_name'), 'YOUR_DATABASE_NAME')]",
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/YOUR_DATABASE_NAME/conversations')]",
      "properties": {
        "resource": {
          "computedProperties": [],
          "conflictResolutionPolicy": {
            "conflictResolutionPath": "/_ts",
            "mode": "LastWriterWins"
          },
          "id": "conversations",
          "indexingPolicy": {
            "automatic": true,
            "excludedPaths": [
              {
                "path": "/\"_etag\"/?"
              }
            ],
            "includedPaths": [
              {
                "path": "/*"
              }
            ],
            "indexingMode": "consistent"
          },
          "partitionKey": {
            "kind": "Hash",
            "paths": [
              "/userId"
            ]
          },
          "uniqueKeyPolicy": {
            "uniqueKeys": []
          }
        }
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', parameters('databaseAccounts_cosmos_name'), 'YOUR_DATABASE_NAME')]",
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/YOUR_DATABASE_NAME/telemetry')]",
      "properties": {
        "resource": {
          "computedProperties": [],
          "conflictResolutionPolicy": {
            "conflictResolutionPath": "/_ts",
            "mode": "LastWriterWins"
          },
          "id": "telemetry",
          "indexingPolicy": {
            "automatic": true,
            "compositeIndexes": [
              [
                {
                  "order": "ascending",
                  "path": "/deviceId"
                },
                {
                  "order": "descending",
                  "path": "/timestamp"
                }
              ]
            ],
            "excludedPaths": [
              {
                "path": "/\"_etag\"/?"
              }
            ],
            "includedPaths": [
              {
                "path": "/*"
              }
            ],
            "indexingMode": "consistent"
          },
          "partitionKey": {
            "kind": "Hash",
            "paths": [
              "/deviceId"
            ]
          },
          "uniqueKeyPolicy": {
            "uniqueKeys": []
          }
        }
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/audio-files')]",
      "properties": {
        "defaultEncryptionScope": "$account-encryption-key",
        "denyEncryptionScopeOverride": false,
        "immutableStorageWithVersioning": {
          "enabled": false
        },
        "publicAccess": "None"
      },
      "type": "Microsoft.Storage/storageAccounts/blobServices/containers"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/azure-webjobs-eventhub')]",
      "properties": {
        "defaultEncryptionScope": "$account-encryption-key",
        "denyEncryptionScopeOverride": false,
        "immutableStorageWithVersioning": {
          "enabled": false
        },
        "publicAccess": "None"
      },
      "type": "Microsoft.Storage/storageAccounts/blobServices/containers"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/azure-webjobs-hosts')]",
      "properties": {
        "defaultEncryptionScope": "$account-encryption-key",
        "denyEncryptionScopeOverride": false,
        "immutableStorageWithVersioning": {
          "enabled": false
        },
        "publicAccess": "None"
      },
      "type": "Microsoft.Storage/storageAccounts/blobServices/containers"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/azure-webjobs-secrets')]",
      "properties": {
        "defaultEncryptionScope": "$account-encryption-key",
        "denyEncryptionScopeOverride": false,
        "immutableStorageWithVersioning": {
          "enabled": false
        },
        "publicAccess": "None"
      },
      "type": "Microsoft.Storage/storageAccounts/blobServices/containers"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/conversation-logs')]",
      "properties": {
        "defaultEncryptionScope": "$account-encryption-key",
        "denyEncryptionScopeOverride": false,
        "immutableStorageWithVersioning": {
          "enabled": false
        },
        "publicAccess": "None"
      },
      "type": "Microsoft.Storage/storageAccounts/blobServices/containers"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/function-releases')]",
      "properties": {
        "defaultEncryptionScope": "$account-encryption-key",
        "denyEncryptionScopeOverride": false,
        "immutableStorageWithVersioning": {
          "enabled": false
        },
        "publicAccess": "None"
      },
      "type": "Microsoft.Storage/storageAccounts/blobServices/containers"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/memory-files')]",
      "properties": {
        "defaultEncryptionScope": "$account-encryption-key",
        "denyEncryptionScopeOverride": false,
        "immutableStorageWithVersioning": {
          "enabled": false
        },
        "publicAccess": "None"
      },
      "type": "Microsoft.Storage/storageAccounts/blobServices/containers"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/module-updates')]",
      "properties": {
        "defaultEncryptionScope": "$account-encryption-key",
        "denyEncryptionScopeOverride": false,
        "immutableStorageWithVersioning": {
          "enabled": false
        },
        "publicAccess": "None"
      },
      "type": "Microsoft.Storage/storageAccounts/blobServices/containers"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/scm-releases')]",
      "properties": {
        "defaultEncryptionScope": "$account-encryption-key",
        "denyEncryptionScopeOverride": false,
        "immutableStorageWithVersioning": {
          "enabled": false
        },
        "publicAccess": "None"
      },
      "type": "Microsoft.Storage/storageAccounts/blobServices/containers"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/voicetestpython')]",
      "properties": {
        "defaultEncryptionScope": "$account-encryption-key",
        "denyEncryptionScopeOverride": false,
        "immutableStorageWithVersioning": {
          "enabled": false
        },
        "publicAccess": "None"
      },
      "type": "Microsoft.Storage/storageAccounts/blobServices/containers"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/fileServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/YOUR_CONVERSATION_LOGGER4ae636542e3f')]",
      "properties": {
        "accessTier": "TransactionOptimized",
        "enabledProtocols": "SMB",
        "shareQuota": 102400
      },
      "type": "Microsoft.Storage/storageAccounts/fileServices/shares"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/fileServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/YOUR_CONVERSATION_LOGGER4882b54c')]",
      "properties": {
        "accessTier": "TransactionOptimized",
        "enabledProtocols": "SMB",
        "shareQuota": 102400
      },
      "type": "Microsoft.Storage/storageAccounts/fileServices/shares"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/fileServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/YOUR_MEMORY_GENERATOR439365e28ba5')]",
      "properties": {
        "accessTier": "TransactionOptimized",
        "enabledProtocols": "SMB",
        "shareQuota": 102400
      },
      "type": "Microsoft.Storage/storageAccounts/fileServices/shares"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/tableServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/AzureFunctionsDiagnosticEvents202508')]",
      "properties": {},
      "type": "Microsoft.Storage/storageAccounts/tableServices/tables"
    },
    {
      "apiVersion": "2025-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/tableServices', parameters('storageAccounts_storage_name'), 'default')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccounts_storage_name'))]"
      ],
      "name": "[concat(parameters('storageAccounts_storage_name'), '/default/AzureFunctionsDiagnosticEventsCheck')]",
      "properties": {},
      "type": "Microsoft.Storage/storageAccounts/tableServices/tables"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers', parameters('databaseAccounts_cosmos_name'), 'YOUR_DATABASE_NAME', 'conversations')]",
        "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', parameters('databaseAccounts_cosmos_name'), 'YOUR_DATABASE_NAME')]",
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/YOUR_DATABASE_NAME/conversations/bulkDelete')]",
      "properties": {
        "resource": {
          "body": "function bulkDelete() {\n   var collection = getContext().getCollection();\n   var collectionLink = collection.getSelfLink();\n   var response = getContext().getResponse();\n   var responseBody = {\n       deleted: 0,\n       continuation: true,\n       processed: 0\n   };\n\n   var query = \"SELECT c._self, c.deviceId FROM c WHERE c.type = 'system_telemetry' AND c.timestamp < '2025-07-01T00:00:00Z'\";\n\n   var requestOptions = {\n       pageSize: 1000\n   };\n\n   var isAccepted = collection.queryDocuments(\n       collectionLink,\n       query,\n       requestOptions,\n       function(err, items, responseOptions) {\n           if (err) throw err;\n\n           responseBody.processed = items.length;\n\n           if (items.length === 0) {\n               responseBody.continuation = false;\n           }\n\n           var deleteCount = 0;\n           for (var i = 0; i < items.length; i++) {\n               var accepted = collection.deleteDocument(\n                   items[i]._self,\n                   {},\n                   function(err) {\n                       if (err) throw err;\n                       deleteCount++;\n                       if (deleteCount === items.length) {\n                           responseBody.deleted = deleteCount;\n                           response.setBody(responseBody);\n                       }\n                   }\n               );\n\n               if (!accepted) {\n                   responseBody.deleted = deleteCount;\n                   break;\n               }\n           }\n       }\n   );\n\n   if (!isAccepted) {\n       response.setBody(responseBody);\n   }\n}",
          "id": "bulkDelete"
        }
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/storedProcedures"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers', parameters('databaseAccounts_cosmos_name'), 'YOUR_DATABASE_NAME', 'conversations')]",
        "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', parameters('databaseAccounts_cosmos_name'), 'YOUR_DATABASE_NAME')]",
        "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('databaseAccounts_cosmos_name'))]"
      ],
      "name": "[concat(parameters('databaseAccounts_cosmos_name'), '/YOUR_DATABASE_NAME/conversations/bulkDeleteUnwantedTypes')]",
      "properties": {
        "resource": {
          "body": "function bulkDeleteUnwantedTypes() {\n   var collection = getContext().getCollection();\n   var collectionLink = collection.getSelfLink();\n   var response = getContext().getResponse();\n   var responseBody = {\n       deleted: 0,\n       continuation: true,\n       processed: 0\n   };\n\n   var query = \"SELECT c._self, c.deviceId FROM c WHERE c.type IN ('system_telemetry', 'unknown')\";\n\n   var requestOptions = {\n       pageSize: 1000\n   };\n\n   var isAccepted = collection.queryDocuments(\n       collectionLink,\n       query,\n       requestOptions,\n       function(err, items, responseOptions) {\n           if (err) throw err;\n\n           responseBody.processed = items.length;\n\n           if (items.length === 0) {\n               responseBody.continuation = false;\n           }\n\n           var deleteCount = 0;\n           for (var i = 0; i < items.length; i++) {\n               var accepted = collection.deleteDocument(\n                   items[i]._self,\n                   {},\n                   function(err) {\n                       if (err) throw err;\n                       deleteCount++;\n                       if (deleteCount === items.length) {\n                           responseBody.deleted = deleteCount;\n                           response.setBody(responseBody);\n                       }\n                   }\n               );\n\n               if (!accepted) {\n                   responseBody.deleted = deleteCount;\n                   break;\n               }\n           }\n       }\n   );\n\n   if (!isAccepted) {\n       response.setBody(responseBody);\n   }\n}",
          "id": "bulkDeleteUnwantedTypes"
        }
      },
      "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/storedProcedures"
    }
  ],
  "variables": {}
}
